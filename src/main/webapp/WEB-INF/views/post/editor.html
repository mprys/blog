<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Create a New Post</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link href="../../../resources/css/bootstrap.min.css" rel="stylesheet" media="screen" th:href="@{/resources/css/bootstrap.min.css}"/>
    <link href="../../../resources/css/core.css" rel="stylesheet" media="screen" th:href="@{/resources/css/core.css}" />
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script src="../../../resources/js/bootstrap.min.js" th:src="@{/resources/js/bootstrap.min.js}"></script>
    <script src="../../../resources/js/angular/angular.js" th:src="@{/resources/js/angular/angular.js}"></script>
    <script src="../../../resources/js/app.js" th:src="@{/resources/js/app.js}"></script>
    
    <script type="text/javascript">
    	function onLoad(){
    		$("#closeButton").hide();
    	}
    </script>
    <script>
    	$(document).ready(function(){
    		$("#createPost").submit(function(event){
    			$.ajax({
        			url : $("#createPost").attr('action'),
	            	data : $("#createPost").serialize(),
	            	type : "POST",
	            	dataType : "json",
	            	success : function(json) {
	       					$("#createPost").hide();
	            			$("#messageDiv").addClass("alert alert-dismissable alert-success");
	            			$("#resultMessage").text("New Post created!");
	            			$("#postDetails").addClass("jumbotron");
	            			$("#title").text(json['title']);
	            			$("#content").text(json['content']);
	            			$("#publishLink").text("Publish");
	            			$("#publishLink").attr('href', 'publish/' + json['id']);
	            			$("#publishLink").addClass("btn btn-primary");
	            			$("#closeButton").show();
	            	 	},
	            	error : function( xhr, status ) {
	            	        alert( "there was a problem!" );
	            	    },
	            	complete : function( xhr, status ) {
	            	        //alert( "The request is complete!" );
	            	    }
    			});
    			return false;
    		});

   			 $("#publishLink").click(function(event){
   	             $.ajax({
   	            	 url:$(event.target).attr("href"),
   	            	 type: "PUT",
   	            	 dataType : "json",
   	            	 success: function( json ) {
   	            			$("#resultMessage").text("Your post published succesfully!");
   	            			$("#publishLink").attr('disabled', true);
   	            	 	},
   	            	 error: function( xhr, status ) {
   	            	        //alert( "there was a problem!" );
   	            	    },
   	            	 complete: function( xhr, status ) {
   	            	        //alert( "The request is complete!" );
   	            	    }
   	             });   
   	             
   	             return false;
   	        });
    	});
    </script>
</head>

<body onload="onLoad();" ng-app="sampleApp">

<script type="text/ng-template" id="postdetails.html">

<h2> Add Order </h2>
{{message}}

</script>
<div th:substituteby="fragments/header :: header">&nbsp;</div>
<div  class="container" >
<div id="messageDiv">
   <button id="closeButton" type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
   <span id="resultMessage"></span>
</div>
<div id="postDetails">
	<p id="title"></p>
	<p id="content"></p>
	<a id="publishLink"></a>
	<a href="#/postdetails/12" >Details</a>
</div>

	<form class="form-narrow form-horizontal" id="createPost" method="post" th:action="@{/post/create}" th:object="${Post}">
	    <!-- /* Show general error message when form contains errors */ -->
	    
	    <th:block th:if="${#fields.hasErrors('${Post.*}')}">
	        <div th:replace="fragments/alert :: alert (type='danger', message='Form contains errors. Please try again.')">Alert</div>
	    </th:block>
	    <fieldset>
	        <legend>New Post details</legend>
	        <div class="form-group" th:classappend="${#fields.hasErrors('title')}? 'has-error'">
	            <label for="title" class="col-lg-2 control-label">Title</label>
	            <div class="col-lg-10">
	                <input type="text" class="form-control" id="title" placeholder="Title of your post" th:field="*{title}" />
	                <span class="help-block" th:if="${#fields.hasErrors('title')}" th:errors="*{title}">Should not be empty</span>
	            </div>
	        </div>
	        <div class="form-group" th:classappend="${#fields.hasErrors('content')}? 'has-error'">
	            <label for="content" class="col-lg-2 control-label">Content</label>
	            <div class="col-lg-10">
	                <input type="text" class="form-control" id="content" placeholder="Content of your post" th:field="*{content}"/>
	                <span class="help-block" th:if="${#fields.hasErrors('content')}" th:errors="*{content}">Minimum 100 characters</span>
	            </div>
	        </div>
	        <div class="form-group">
	            <div class="col-lg-offset-2 col-lg-10">
	                <button type="submit" class="btn btn-default">Save</button>
	                <button type="submit" class="btn btn-default">Cancel</button>
	            </div>
	        </div>
	    </fieldset>
	</form>
</div>
</body>
</html>